---
import Layout from '../../layouts/Layout.astro';
import TopBar from '../../components/TopBar.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import { getAllTags, getPapersByTag, getPaperSlug, getTagDisplayName } from '../../utils/papers.ts';
import { getTagColorCSS } from '../../utils/tagColors.ts';
import '../../styles/page-tags.css';

export async function getStaticPaths() {
  const tags = getAllTags();
  return tags.map((tagDisplay) => ({
    params: { tag: tagDisplay.toLowerCase().replace(/\s+/g, '-') },
    props: { tagDisplay },
  }));
}

const { tag } = Astro.params;
const tagDisplay = Astro.props.tagDisplay || getTagDisplayName(tag || '');
const papers = getPapersByTag(tagDisplay || tag || '');

const title = `Papers tagged "${tagDisplay || tag}"`;
const description = `Explore AI research papers tagged with ${tagDisplay || tag}. Deep dives into machine learning, NLP, and more.`;
---

<Layout
  title={`${title} - Shristi Gautam`}
  description={description}
  ogImage="/assets/bio-image.jpg"
>
  <TopBar />
  <Breadcrumb items={[
    { label: 'Home', href: '/' },
    { label: 'Paper Dive-Ins', href: '/paper-dive-ins' },
    { label: tagDisplay || tag || 'Tag' }
  ]} />
  <div class="page-container page-tags-container">
    <h1 class="page-title page-tags-title app-struct">{title}</h1>
    <p class="page-tags-description">
      {papers.length} {papers.length === 1 ? 'paper' : 'papers'} tagged with
      <strong>{tagDisplay || tag}</strong>
    </p>
    <div class="paper-list-grid page-tags-list-grid app-struct">
      {papers.map((paper) => {
        const slug = getPaperSlug(paper);
        return (
          <div key={paper.title.replace(/\s/g, '')}>
            <a href={`/paper-breakdown/${slug}`} class="page-tags-card-link">
              <div class="paper-card-layout paper-card-layout--bordered">
                <div class="paper-card-image-wrap">
                  <img
                    src={paper.img.src}
                    alt={paper.img.alt}
                    class="paper-card-image"
                    loading="lazy"
                  />
                </div>
                <div class="page-tags-card-info">
                  <h2 class="paper-card-title paper-card-title--small">{paper.title}</h2>
                  <div class="page-tags-tags-row">
                    {paper.tags.map((t) => {
                      const colorCSS = getTagColorCSS(t);
                      return (
                        <span key={t} class="shared-tag-chip" style={colorCSS}>{t}</span>
                      );
                    })}
                  </div>
                  <p class="paper-card-description paper-card-description--small">{paper.description}</p>
                </div>
              </div>
            </a>
          </div>
        );
      })}
    </div>
    <p class="page-tags-back-link">
      <a href="/paper-dive-ins">‚Üê Back to all papers</a>
    </p>
  </div>
</Layout>
